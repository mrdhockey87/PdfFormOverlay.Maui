<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:pdf="clr-namespace:Vitvov.Maui.PDFView;assembly=Vitvov.Maui.PDFView"
             x:Class="PdfFormOverlay.Maui.PdfFormPage"
             Title="PDF Form Editor">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Security Status Bar -->
        <StackLayout Grid.Row="0"
                     x:Name="securityStatusBar"
                     Orientation="Horizontal"
                     BackgroundColor="LightBlue"
                     Padding="10,5"
                     IsVisible="False">
            <Image Source="lock_icon.png" WidthRequest="16" HeightRequest="16" />
            <Label x:Name="securityStatusLabel"
                   Text="Secure Session Active"
                   VerticalOptions="Center"
                   FontSize="12" />
            <Button Text="Lock"
                    x:Name="lockButton"
                    Clicked="OnLockClicked"
                    BackgroundColor="Red"
                    TextColor="White"
                    FontSize="12"
                    Padding="8,4"
                    HorizontalOptions="EndAndExpand" />
        </StackLayout>

        <!-- PDF Viewer Container with Overlay -->
        <ScrollView Grid.Row="1" x:Name="pdfScrollView">
            <AbsoluteLayout x:Name="pdfContainer" BackgroundColor="LightGray">
                <!-- PDF Viewer -->
                <pdf:PDFView x:Name="pdfView"
                             AbsoluteLayout.LayoutBounds="0,0,1,1"
                             AbsoluteLayout.LayoutFlags="All" />

                <!-- Form overlay will be added programmatically here -->
            </AbsoluteLayout>
        </ScrollView>

        <!-- Form Actions Panel -->
        <StackLayout Grid.Row="2"
                     x:Name="formActionsPanel"
                     Orientation="Vertical"
                     Spacing="5"
                     Padding="10"
                     BackgroundColor="White"
                     IsVisible="False">

            <!-- Data Management Row -->
            <StackLayout Orientation="Horizontal"
                         HorizontalOptions="Center"
                         Spacing="10">
                <Button Text="Save Data"
                        x:Name="saveDataButton"
                        Clicked="OnSaveDataClicked"
                        BackgroundColor="DodgerBlue"
                        TextColor="White"
                        CornerRadius="5"
                        FontSize="14" />

                <Button Text="Load Data"
                        x:Name="loadDataButton"
                        Clicked="OnLoadDataClicked"
                        BackgroundColor="Orange"
                        TextColor="White"
                        CornerRadius="5"
                        FontSize="14" />

                <Button Text="Delete Data"
                        x:Name="deleteDataButton"
                        Clicked="OnDeleteDataClicked"
                        BackgroundColor="Red"
                        TextColor="White"
                        CornerRadius="5"
                        FontSize="14" />
            </StackLayout>

            <!-- PDF Output Row -->
            <StackLayout Orientation="Horizontal"
                         HorizontalOptions="Center"
                         Spacing="10">
                <Button Text="Save PDF"
                        x:Name="savePdfButton"
                        Clicked="OnSavePdfClicked"
                        BackgroundColor="Green"
                        TextColor="White"
                        CornerRadius="5"
                        FontSize="14" />

                <Button Text="Print PDF"
                        x:Name="printPdfButton"
                        Clicked="OnPrintPdfClicked"
                        BackgroundColor="Purple"
                        TextColor="White"
                        CornerRadius="5"
                        FontSize="14" />

                <Button Text="Email PDF"
                        x:Name="emailPdfButton"
                        Clicked="OnEmailPdfClicked"
                        BackgroundColor="Teal"
                        TextColor="White"
                        CornerRadius="5"
                        FontSize="14" />
            </StackLayout>
        </StackLayout>

        <!-- Security Overlay (shown when locked) -->
        <Grid x:Name="securityOverlay"
              Grid.RowSpan="3"
              BackgroundColor="#AA000000"
              IsVisible="False">
            <StackLayout VerticalOptions="Center"
                         HorizontalOptions="Center"
                         BackgroundColor="White"
                         Padding="30"
                         Spacing="15">
                <Image Source="lock_icon.png" WidthRequest="48" HeightRequest="48" />
                <Label Text="Session Locked"
                       FontSize="18"
                       FontAttributes="Bold"
                       HorizontalOptions="Center" />
                <Label Text="Enter your password to continue"
                       FontSize="14"
                       HorizontalOptions="Center" />
                <Entry x:Name="unlockPasswordEntry"
                       Placeholder="Password"
                       IsPassword="True"
                       WidthRequest="200" />
                <StackLayout Orientation="Horizontal" Spacing="10">
                    <Button Text="Unlock"
                            Clicked="OnUnlockClicked"
                            BackgroundColor="Green"
                            TextColor="White" />
                    <Button Text="Forgot Password"
                            Clicked="OnForgotPasswordClicked"
                            BackgroundColor="Orange"
                            TextColor="White" />
                </StackLayout>
            </StackLayout>
        </Grid>
    </Grid>
</ContentPage>